<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>famelico</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-container">
      <a class="navbar-brand" href="index.html">famelico
      </a>
      <ul class="nav-links">
        <li><a href="ingredienti.html">Ingredients</a></li>
        <li><a href="ricette.html">Recipes</a></li>
        <li><a href="regioni.html">Regions</a></li>
        <li><a href="fonti.html">Sources</a></li>
      </ul>
      <div class="navbar-right"><a href="about.html">About</a></div>
    </div>
  </nav>

  <!-- Mappa delle Regioni -->
  <div class="container mt-5">
    <div class="svg-container text-center">
      <!-- Inserisci la mappa SVG dell'Italia -->
      <object id="italia-map" data="../images/italia.svg" type="image/svg+xml" class="w-100"></object>
      <div id="region-tooltip" class="region-tooltip"></div>
    </div>
    <img src="images/decoration-color.png" alt="decorative left" class="decorative-left">
    <img src="images/decoration-bird.png" alt="decorative right" class="decorative-right">
  </div>

  <!-- Sezione Ricette -->
  <div class="container mt-5 d-none" id="recipe-section">
    <div class="d-flex justify-content-center align-items-center mb-3">
      <button class="btn btn-secondary me-3" id="back-to-regions">
        <i class="fas fa-arrow-left"></i> Back to Map
      </button>
    </div>
    <div class="row recipe-container">
      <!-- Qui verranno inserite dinamicamente le ricette -->
    </div>
  </div>  

  <footer class="footer">
    <div class="footer-container">
      <!-- Logo or Project Name -->
      <a class="footer-logo">famelico
      </a>
      <!-- Project Information -->
      <div class="footer-info">
        <p>&copy; 2024 Famelico. All rights reserved.</p>
        <p>
          Project developed for the final thesis in 
          <a href="https://corsi.unibo.it/2cycle/DigitalHumanitiesKnowledge" target="_blank" style="color: #971a0f">Digital Humanities and Digital Knowledge</a>.
        </p>
      </div>
      <!-- Social Media -->
      <div class="footer-social">
        <a href="https://github.com" target="_blank" aria-label="Github">
          <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="60" height="60" viewBox="0,0,256,256">
            <g fill="#5a4631" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
              <g transform="scale(8.53333,8.53333)">
                <path d="M15,3c-6.627,0 -12,5.373 -12,12c0,5.623 3.872,10.328 9.092,11.63c-0.056,-0.162 -0.092,-0.35 -0.092,-0.583v-2.051c-0.487,0 -1.303,0 -1.508,0c-0.821,0 -1.551,-0.353 -1.905,-1.009c-0.393,-0.729 -0.461,-1.844 -1.435,-2.526c-0.289,-0.227 -0.069,-0.486 0.264,-0.451c0.615,0.174 1.125,0.596 1.605,1.222c0.478,0.627 0.703,0.769 1.596,0.769c0.433,0 1.081,-0.025 1.691,-0.121c0.328,-0.833 0.895,-1.6 1.588,-1.962c-3.996,-0.411 -5.903,-2.399 -5.903,-5.098c0,-1.162 0.495,-2.286 1.336,-3.233c-0.276,-0.94 -0.623,-2.857 0.106,-3.587c1.798,0 2.885,1.166 3.146,1.481c0.896,-0.307 1.88,-0.481 2.914,-0.481c1.036,0 2.024,0.174 2.922,0.483c0.258,-0.313 1.346,-1.483 3.148,-1.483c0.732,0.731 0.381,2.656 0.102,3.594c0.836,0.945 1.328,2.066 1.328,3.226c0,2.697 -1.904,4.684 -5.894,5.097c1.098,0.573 1.899,2.183 1.899,3.396v2.734c0,0.104 -0.023,0.179 -0.035,0.268c4.676,-1.639 8.035,-6.079 8.035,-11.315c0,-6.627 -5.373,-12 -12,-12z"></path>
              </g>
            </g>
          </svg>
        </a>
        <a href="https://linkedin.com" target="_blank" aria-label="Linkedin">
          <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="60" height="60" viewBox="0,0,256,256">
            <g fill="#5a4631" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
              <g transform="scale(8.53333,8.53333)">
                <path d="M24,4h-18c-1.105,0 -2,0.895 -2,2v18c0,1.105 0.895,2 2,2h18c1.105,0 2,-0.895 2,-2v-18c0,-1.105 -0.895,-2 -2,-2zM10.954,22h-2.95v-9.492h2.95zM9.449,11.151c-0.951,0 -1.72,-0.771 -1.72,-1.72c0,-0.949 0.77,-1.719 1.72,-1.719c0.948,0 1.719,0.771 1.719,1.719c0,0.949 -0.771,1.72 -1.719,1.72zM22.004,22h-2.948v-4.616c0,-1.101 -0.02,-2.517 -1.533,-2.517c-1.535,0 -1.771,1.199 -1.771,2.437v4.696h-2.948v-9.492h2.83v1.297h0.04c0.394,-0.746 1.356,-1.533 2.791,-1.533c2.987,0 3.539,1.966 3.539,4.522z"></path>
              </g>
            </g>
          </svg>
        </a>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll(".nav-links a");
      const recipeSection = document.getElementById('recipe-section'); 
      const recipeContainer = document.querySelector('.recipe-container'); 
      const backToRegions = document.getElementById('back-to-regions'); 
      const italyMap = document.getElementById('italia-map'); 
  
      // Evidenzia il link di menu corrente
      navLinks.forEach((link) => {
        if (link.href.includes(currentPath)) {
          link.classList.add("active");
        } else {
          link.classList.remove("active");
        }
      });
  
      let ricetteData = [];
      let variantiData = [];
  
      // Carica i dati JSON (ricette e varianti)
      try {
        const [ricette, varianti] = await Promise.all([
          fetch('data/ricette.json').then(res => res.json()),
          fetch('data/varianti.json').then(res => res.json())
        ]);
        ricetteData = ricette;
        variantiData = varianti;
        console.log('Dati ricette caricati:', ricetteData);
        console.log('Dati varianti caricati:', variantiData);
      } catch (error) {
        console.error('Errore nel caricamento dei dati:', error);
      }
  
      // ============= FUNZIONI DI SUPPORTO =============
  
      // Mostra le ricette della regione (id minuscolo, es. "emilia-romagna")
      function showRecipesForRegion(regioneId) {
        // Svuota eventuali ricette precedenti
        recipeContainer.innerHTML = '';
  
        const ricettePerRegione = ricetteData.filter(
          ricetta => ricetta.regione.toLowerCase() === regioneId
        );
  
        if (ricettePerRegione.length > 0) {
          ricettePerRegione.forEach(ricetta => {
            const variantiLinks = Array.isArray(ricetta.varianti)
              ? ricetta.varianti.map(varianteId => getVarianteLink(varianteId)).join(', ')
              : '';
  
            const card = document.createElement('div');
            card.id = ricetta.id; 
            card.className = 'ricetta-card';
            card.innerHTML = `
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">${ricetta.nome}</h5>
                  <p class="card-text">
                    <strong>Regione:</strong>
                    <!-- Link con hash verso la stessa pagina -->
                    <a href="regioni.html#${ricetta.regione.toLowerCase()}" class="regione-link">
                      ${ricetta.regione}
                    </a>
                  </p>
                  <p class="card-text"><strong>Categoria:</strong> ${ricetta.categoria}</p>
                  <p class="card-text"><strong>Varianti:</strong> ${variantiLinks}</p>
                </div>
              </div>
            `;
            recipeContainer.appendChild(card);
          });
        } else {
          alert('Nessuna ricetta trovata per questa regione: ' + regioneId);
        }
  
        // Mostra la sezione ricette e nasconde la mappa
        recipeSection.classList.remove('d-none');
        italyMap.classList.add('d-none');
      }
  
      // Dato un id variante, costruisce il link col nome
      function getVarianteLink(varianteId) {
        const variante = variantiData.find(item => item.id === varianteId);
        if (!variante) return varianteId; // fallback
        return `<a href="ricette.html#${variante.id}">${variante.nome}</a>`;
      }
  
      // Se l’URL contiene un hash, mostra subito le ricette della regione
      function handleRegionHash() {
        const hash = window.location.hash.replace('#', '');
        if (hash) {
          showRecipesForRegion(hash.toLowerCase());
        }
      }
  
      // ============= GESTIONE MAPPA SVG =============
      italyMap.addEventListener('load', () => {
        const svgDoc = italyMap.contentDocument;
        if (!svgDoc) {
          console.error("Non è stato possibile accedere al contenuto SVG.");
          return;
        }
  
        const svgElement = svgDoc.querySelector("svg");
        const tooltip = svgDoc.createElementNS("http://www.w3.org/2000/svg", "text");
        tooltip.setAttribute("id", "svg-tooltip");
        tooltip.setAttribute("fill", "#333");
        tooltip.setAttribute("font-size", "35px");
        tooltip.setAttribute("visibility", "hidden");
        svgElement.appendChild(tooltip);
  
        const regions = svgDoc.querySelectorAll('path[id]'); 
  
        regions.forEach(region => {
          // Tooltip mouseenter
          region.addEventListener('mouseenter', () => {
            tooltip.setAttribute("visibility", "visible");
            const regionName = region.id.charAt(0).toUpperCase() + region.id.slice(1).replace(/-/g, ' ');
            tooltip.textContent = regionName;
            region.style.fill = '#5a4631';
            region.style.cursor = 'pointer'; 
          });
  
          // Tooltip mousemove
          region.addEventListener('mousemove', (e) => {
            const point = svgElement.createSVGPoint();
            point.x = e.clientX;
            point.y = e.clientY;
            const cursorPoint = point.matrixTransform(svgElement.getScreenCTM().inverse());
            tooltip.setAttribute("x", cursorPoint.x + 25);
            tooltip.setAttribute("y", cursorPoint.y + 60);
          });
  
          // Tooltip mouseleave
          region.addEventListener('mouseleave', () => {
            tooltip.setAttribute("visibility", "hidden");
            region.style.fill = ''; 
          });
  
          // Click sulla regione => mostra ricette
          region.addEventListener('click', () => {
            const regioneId = region.id.toLowerCase();
            showRecipesForRegion(regioneId);
          });
        });
  
        // Una volta caricata la mappa, controlla se c’è un hash
        handleRegionHash();
      });
  
      // Aggiorna le ricette se l’hash cambia mentre siamo su questa pagina
      window.addEventListener('hashchange', handleRegionHash);
  
      // Bottone “Torna alla mappa”
      backToRegions.addEventListener('click', () => {
        recipeSection.classList.add('d-none');
        italyMap.classList.remove('d-none');
        recipeContainer.innerHTML = '';
        // Se desideri rimuovere l’hash dall’URL
        if (window.location.hash) {
          history.pushState("", document.title, window.location.pathname + window.location.search);
        }
      });
    });
  </script>
  

  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
